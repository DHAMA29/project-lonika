<!DOCTYPE html>
<html>
    <head>
        <title>Test AJAX Category Filtering</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <style>
            .test-section {
                margin: 20px 0;
                padding: 20px;
                border: 1px solid #ddd;
                border-radius: 8px;
            }
            .debug-log {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                border-radius: 4px;
                padding: 10px;
                max-height: 300px;
                overflow-y: auto;
                font-family: monospace;
                font-size: 12px;
            }
            .url-display {
                background: #e9ecef;
                padding: 10px;
                border-radius: 4px;
                margin: 10px 0;
                font-family: monospace;
            }
        </style>
    </head>
    <body>
        <div class="container my-4">
            <h1>Test AJAX Category Filtering System</h1>

            <div class="test-section">
                <h3>Current URL Information</h3>
                <div class="url-display" id="urlDisplay">
                    Current URL: <span id="currentUrl"></span>
                </div>
                <div class="url-display" id="paramsDisplay">
                    Parameters: <span id="currentParams"></span>
                </div>
            </div>

            <div class="test-section">
                <h3>Test Filtering Endpoints</h3>
                <p>Click buttons below to test AJAX filtering:</p>

                <div class="btn-group" role="group">
                    <button
                        type="button"
                        class="btn btn-outline-primary"
                        onclick="testFilter('all')"
                    >
                        All Products
                    </button>
                    <button
                        type="button"
                        class="btn btn-outline-primary"
                        onclick="testFilter('1')"
                    >
                        Kamera (ID: 1)
                    </button>
                    <button
                        type="button"
                        class="btn btn-outline-primary"
                        onclick="testFilter('2')"
                    >
                        Audio (ID: 2)
                    </button>
                    <button
                        type="button"
                        class="btn btn-outline-primary"
                        onclick="testFilter('3')"
                    >
                        Lighting (ID: 3)
                    </button>
                    <button
                        type="button"
                        class="btn btn-outline-primary"
                        onclick="testFilter('4')"
                    >
                        Drone (ID: 4)
                    </button>
                </div>
            </div>

            <div class="test-section">
                <h3>Response Results</h3>
                <div id="resultsDisplay" class="alert alert-info">
                    Click a filter button to see results...
                </div>
            </div>

            <div class="test-section">
                <h3>Debug Log</h3>
                <div class="debug-log" id="debugLog">
                    Ready for testing...<br />
                </div>
                <button
                    type="button"
                    class="btn btn-sm btn-secondary"
                    onclick="clearLog()"
                >
                    Clear Log
                </button>
            </div>
        </div>

        <script>
            function log(message) {
                const debugLog = document.getElementById("debugLog");
                const timestamp = new Date().toLocaleTimeString();
                debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
                debugLog.scrollTop = debugLog.scrollHeight;
                console.log(message);
            }

            function clearLog() {
                document.getElementById("debugLog").innerHTML =
                    "Log cleared...<br>";
            }

            function updateUrlDisplay() {
                document.getElementById("currentUrl").textContent =
                    window.location.href;
                const params = new URLSearchParams(window.location.search);
                const paramsObj = {};
                for (let [key, value] of params) {
                    paramsObj[key] = value;
                }
                document.getElementById("currentParams").textContent =
                    JSON.stringify(paramsObj);
            }

            function testFilter(categoryId) {
                log(`=== TESTING FILTER: ${categoryId} ===`);

                // Build URL (using Laravel route structure)
                const baseUrl =
                    "http://127.0.0.1:8000/peminjaman/filter/category/" +
                    categoryId;

                log(`Making AJAX request to: ${baseUrl}`);

                // Show loading state
                const resultsDiv = document.getElementById("resultsDisplay");
                resultsDiv.className = "alert alert-warning";
                resultsDiv.innerHTML =
                    '<div class="spinner-border spinner-border-sm me-2"></div>Loading...';

                // Make AJAX request
                $.ajax({
                    url: baseUrl,
                    method: "GET",
                    dataType: "json",
                    timeout: 10000,
                    success: function (response) {
                        log(`✅ Success: ${JSON.stringify(response)}`);

                        // Update URL simulation
                        const newUrl =
                            window.location.pathname +
                            "?category=" +
                            categoryId;
                        window.history.pushState(
                            { category: categoryId },
                            "",
                            newUrl
                        );
                        updateUrlDisplay();

                        // Show results
                        resultsDiv.className = "alert alert-success";
                        resultsDiv.innerHTML = `
                        <h5>✅ Success!</h5>
                        <p><strong>Category:</strong> ${
                            response.category_name
                        }</p>
                        <p><strong>Products Found:</strong> ${
                            response.count
                        }</p>
                        <p><strong>Message:</strong> ${response.message}</p>
                        <details>
                            <summary>Raw Response</summary>
                            <pre>${JSON.stringify(response, null, 2)}</pre>
                        </details>
                    `;
                    },
                    error: function (xhr, status, error) {
                        log(`❌ Error: ${error}`);
                        log(`Status: ${status}`);
                        log(`Response: ${xhr.responseText}`);

                        resultsDiv.className = "alert alert-danger";
                        resultsDiv.innerHTML = `
                        <h5>❌ Error!</h5>
                        <p><strong>Status:</strong> ${status}</p>
                        <p><strong>Error:</strong> ${error}</p>
                        <p><strong>Response:</strong> ${xhr.responseText}</p>
                    `;
                    },
                    complete: function () {
                        log(`Request completed for category: ${categoryId}`);
                    },
                });
            }

            // Initialize
            $(document).ready(function () {
                log("Page loaded, ready for testing");
                updateUrlDisplay();

                // Handle browser back/forward
                window.addEventListener("popstate", function (event) {
                    log("Popstate event detected");
                    updateUrlDisplay();
                });
            });
        </script>
    </body>
</html>
