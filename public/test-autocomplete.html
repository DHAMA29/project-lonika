<!DOCTYPE html>
<html>
    <head>
        <title>Test Autocomplete</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
            rel="stylesheet"
        />
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            .autocomplete-container {
                position: relative;
            }
            .autocomplete-suggestions {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: white;
                border: 1px solid #ddd;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                max-height: 300px;
                overflow-y: auto;
                z-index: 1000;
                display: none;
            }
            .autocomplete-item {
                padding: 12px 16px;
                cursor: pointer;
                border-bottom: 1px solid #f0f0f0;
            }
            .autocomplete-item:hover {
                background-color: #f8f9fa;
            }
            .autocomplete-name {
                font-weight: 600;
                margin-bottom: 4px;
            }
            .autocomplete-details {
                font-size: 12px;
                color: #666;
            }
        </style>
    </head>
    <body>
        <div class="container py-5">
            <h2>Test Autocomplete Checkout</h2>
            <div class="row">
                <div class="col-md-6">
                    <label for="nama" class="form-label"
                        >Nama Lengkap (Test)</label
                    >
                    <div class="autocomplete-container">
                        <input
                            type="text"
                            class="form-control"
                            id="nama"
                            name="nama"
                            placeholder="Ketik 'Budi' untuk test"
                        />
                        <div
                            class="autocomplete-suggestions"
                            id="autocompleteSuggestions"
                        ></div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <label for="email" class="form-label">Email</label>
                    <input
                        type="email"
                        class="form-control"
                        id="email"
                        name="email"
                    />
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    <label for="telepon" class="form-label">Telepon</label>
                    <input
                        type="tel"
                        class="form-control"
                        id="telepon"
                        name="telepon"
                    />
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <label for="alamat" class="form-label">Alamat</label>
                    <textarea
                        class="form-control"
                        id="alamat"
                        name="alamat"
                        rows="3"
                    ></textarea>
                </div>
            </div>
        </div>

        <script>
            // Mock data for testing
            const mockData = [
                {
                    nama: "Budi Santoso",
                    email: "budi.santoso@email.com",
                    telepon: "081234567890",
                    alamat: "Jl. Merdeka No. 123, Jakarta Pusat",
                },
                {
                    nama: "Budi Hermawan",
                    email: "budi.hermawan@email.com",
                    telepon: "081999888777",
                    alamat: "Jl. Thamrin No. 654, Jakarta Pusat",
                },
            ];

            $(document).ready(function () {
                let selectedIndex = -1;
                let currentData = [];

                $("#nama").on("input", function () {
                    const searchTerm = $(this).val().trim().toLowerCase();

                    if (searchTerm.length < 2) {
                        hideSuggestions();
                        return;
                    }

                    // Filter mock data
                    currentData = mockData.filter((item) =>
                        item.nama.toLowerCase().includes(searchTerm)
                    );

                    displaySuggestions(currentData);
                });

                function displaySuggestions(data) {
                    const container = $("#autocompleteSuggestions");
                    container.empty();
                    selectedIndex = -1;

                    if (data.length === 0) {
                        container.html(
                            '<div class="autocomplete-item">Tidak ada data ditemukan</div>'
                        );
                        container.show();
                        return;
                    }

                    data.forEach((item, index) => {
                        const suggestionHtml = `
                        <div class="autocomplete-item" data-index="${index}">
                            <div class="autocomplete-name">
                                <i class="bi bi-person-check"></i> ${item.nama}
                            </div>
                            <div class="autocomplete-details">
                                üìß ${item.email}<br>
                                üìû ${item.telepon}<br>
                                üìç ${item.alamat}
                            </div>
                        </div>
                    `;
                        container.append(suggestionHtml);
                    });

                    $(".autocomplete-item").on("click", function () {
                        const index = $(this).data("index");
                        if (index !== undefined && index < data.length) {
                            selectPeminjam(data[index]);
                        }
                    });

                    container.show();
                }

                function selectPeminjam(peminjamData) {
                    $("#nama").val(peminjamData.nama);
                    $("#email").val(peminjamData.email);
                    $("#telepon").val(peminjamData.telepon);
                    $("#alamat").val(peminjamData.alamat);
                    hideSuggestions();
                }

                function hideSuggestions() {
                    $("#autocompleteSuggestions").hide();
                    selectedIndex = -1;
                }

                // Hide suggestions when clicking outside
                $(document).on("click", function (e) {
                    if (
                        !$(e.target).closest(".autocomplete-container").length
                    ) {
                        hideSuggestions();
                    }
                });
            });
        </script>
    </body>
</html>
